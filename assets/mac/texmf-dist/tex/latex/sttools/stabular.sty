%%
%% This is file `stabular.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% stabular.dtx  (with options: `package')
%% 
%% Copyright (C) 1998-2025 by Sigitas Tolu\v{s}is <sigitas@vtex.lt>
%% UAB VTeX, Mokslinink≈≥ 2A, LT-08412 Vilnius, Lithuania
%% --------------------------------------------------------------------------
%% This work may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either version 1.3
%% of this license or (at your option) any later version.
%% The latest version of this license is in
%%   http://www.latex-project.org/lppl.txt
%% and version 1.3 or later is part of all distributions of LaTeX
%% version 2005/12/01 or later.
%%
%% PURPOSE:   Improve tabular environment.
%%
\NeedsTeXFormat{LaTeX2e}[2025/06/01]
\ProvidesPackage{stabular}
    [2025/06/18 v2.3 Improve tabular environment (ST)]
\chardef\use@@pkg@@array@@variant=0%
\DeclareOption{array}{\global\chardef\use@@pkg@@array@@variant=1}
\ProcessOptions*
%%
%% kernel version tabular
%%
\def\kernel@stabular{\let\@halignto\@empty\kernel@@stabular}
\def\kernel@endstabular{\crcr\egroup\egroup\egroup}
\@namedef{kernel@stabular*}#1{%
  \setlength\dimen@{#1}%
  \edef\@halignto{to\the\dimen@}%
  \kernel@@tabular
  }
\expandafter\let\csname kernel@endstabular*\endcsname\endstabular
\def\kernel@@stabular{\leavevmode
  \bgroup
    \let\@acol\@tabacol
    \let\@classz\@tabclassz
    \let\@classiv\@tabclassiv
    \let\\\@tabularcr
    \kernel@@stabarray
  }
\def\kernel@@stabarray{\m@th\@ifnextchar[\kernel@@sarray{\kernel@@sarray[c]}}
\def\kernel@@sarray[#1]#2{%
  \bgroup
    \setbox\@arstrutbox\hbox{%
      \vrule \@height\arraystretch\ht\strutbox
             \@depth\arraystretch \dp\strutbox
             \@width\z@
             }%
  \@mkpream{#2}%
  \edef\@preamble{%
    \ialign \noexpand\@halignto
      \bgroup \@arstrut \@preamble \tabskip\z@skip \cr
    }%
  \let\@startpbox\@@startpbox \let\@endpbox\@@endpbox
  \let\tabularnewline\\
  %%\let\par\@empty
  \let\@sharp##%
  \set@typeset@protect
  \lineskip\z@skip \baselineskip\z@skip
  \ifhmode \@preamerr\z@ \@@par\fi
  \@preamble
  }
%%
%% array package version tabular
%%
\def\pkgarray@stabular{\def\@halignto{}\pkgarray@@stabular}
\def\pkgarray@endstabular{\endarray\egroup
  \UseTaggingSocket{tbl/hmode/end}%
  }
\expandafter\def\csname pkgarray@stabular*\endcsname#1{%
       \setlength\dimen@{#1}%
       \edef\@halignto{to\the\dimen@}\pkgarray@@stabular}
\expandafter\let\csname pkgarray@endstabular*\endcsname\pkgarray@endstabular
\def\pkgarray@@stabular{%
  \leavevmode
  \UseTaggingSocket{tbl/hmode/begin}%
  \bgroup
    \MathCollectTrue
    \col@sep\tabcolsep \let\d@llarbegin\begingroup
                                    \let\d@llarend\endgroup
    \@kernel@tabular@init
    \pkgarray@@stabarray
  }
\def\pkgarray@@stabarray{\@ifnextchar[{\pkgarray@@sarray}{\pkgarray@@sarray[c]}}
\def\pkgarray@@sarray[#1]#2{%
  \@tempdima \ht \strutbox
  \advance \@tempdima by\extrarowheight
  \setbox \@arstrutbox \hbox{\vrule
             \@height \arraystretch \@tempdima
             \@depth \arraystretch \dp \strutbox
             \@width \z@}%
  \tbl_save_outer_table_cols:
  \begingroup
    \@mkpream{#2}%
    \tbl_count_table_cols:
    \xdef\@preamble{%
      \noexpand \ar@ialign
      \@halignto\bgroup
         \@arstrut
         \UseTaggingSocket{tbl/row/begin}%
         \tbl_init_cell_data_for_row:
          \@preamble
          \tabskip \z@ \cr
      }%
  \endgroup
  \@arrayleft
  \bgroup
    \let\@sharp##\let\protect\relax
    \lineskip \z@
    \baselineskip \z@
    \mathsurround \z@
    \let\\\@arraycr \let\tabularnewline\\%%\let\par\@empty
    \UseTaggingSocket{tbl/init}%
    \@preamble
  }
%%
%% loading the appropriate version
%%
\def\load@stabular#1{%
  \expandafter\let\expandafter\stabular\csname #1@stabular\endcsname
  \expandafter\let\csname stabular*\expandafter\endcsname
    \csname #1@stabular*\endcsname
  \expandafter\let\expandafter\endstabular\csname #1@endstabular\endcsname
  \expandafter\let\csname endstabular*\expandafter\endcsname
    \csname #1@endstabular*\endcsname
  }
\ifcase\number\use@@pkg@@array@@variant\relax
  \@ifpackageloaded{array}{\load@stabular{pkgarray}}{\load@stabular{kernel}}%
  \AddToHook{package/array/after}{\load@stabular{pkgarray}}%
\else\relax
  \@ifpackageloaded{array}{}{\RequirePackage{array}}%
  \load@stabular{pkgarray}%
\fi
\endinput
%%
%% End of file `stabular.sty'.
